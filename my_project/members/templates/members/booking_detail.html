{% extends 'base.html' %}
{% load static %}

{% block title %}Booking Details | StayEase{% endblock %}

{% block hero %}
<div class="booking-hero-section">
    <div class="hero-overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'my_bookings' %}">My Bookings</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Booking #{{ booking.id }}</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="booking-detail-container">
    <!-- Booking Status Banner -->
    <div class="booking-status-banner mb-4 p-3 rounded-4 {% if booking.status == 'Confirmed' %}bg-success-subtle{% elif booking.status == 'Pending' %}bg-warning-subtle{% elif booking.status == 'Cancelled' %}bg-danger-subtle{% else %}bg-info-subtle{% endif %}">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h4 class="mb-0">
                    <i class="bi {% if booking.status == 'Confirmed' %}bi-check-circle-fill{% elif booking.status == 'Pending' %}bi-hourglass-split{% elif booking.status == 'Cancelled' %}bi-x-circle-fill{% else %}bi-info-circle-fill{% endif %} me-2"></i>
                    Your booking is <span class="fw-bold">{{ booking.status }}</span>
                </h4>
            </div>
            <div class="col-md-4 text-md-end">
                {% if booking.status != 'Cancelled' %}
                    <!-- <a href="{% url 'modify_booking' booking.id %}" class="btn btn-sm btn-warning me-2">
                        <i class="bi bi-pencil"></i> Modify
                    </a>
                    <a href="{% url 'cancel_booking' booking.id %}" class="btn btn-sm btn-danger me-2">
                        <i class="bi bi-x-circle"></i> Cancel -->
                    </a>
                {% endif %}
                <a href="#" class="btn btn-sm btn-outline-dark">Need help?</a>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <!-- Booking Summary Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="section-title">Booking Summary</h3>
                    
                    <div class="booking-dates mb-4">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="date-block p-3 border rounded-3">
                                    <h5 class="mb-1">Check-in</h5>
                                    <div class="date-value">{{ booking.check_in|date:"D, M j, Y" }}</div>
                                    <div class="time-value text-muted">After 3:00 PM</div>
                                </div>
                            </div>
                            <div class="col-md-2 d-flex align-items-center justify-content-center">
                                <i class="bi bi-arrow-right fs-4"></i>
                            </div>
                            <div class="col-md-5">
                                <div class="date-block p-3 border rounded-3">
                                    <h5 class="mb-1">Check-out</h5>
                                    <div class="date-value">{{ booking.check_out|date:"D, M j, Y" }}</div>
                                    <div class="time-value text-muted">Before 11:00 AM</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="booking-details">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <span class="detail-label">Booking ID</span>
                                    <span class="detail-value">{{ booking.id }}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <span class="detail-label">Booking Date</span>
                                    <span class="detail-value">{{ booking.created_at|date:"F j, Y" }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <span class="detail-label">Guests</span>
                                    <span class="detail-value">{{ booking.guests }} {% if booking.guests > 1 %}people{% else %}person{% endif %}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <span class="detail-label">Stay</span>
                                    <span class="detail-value">{{ booking.check_in|date:"M j, Y" }} - {{ booking.check_out|date:"M j, Y" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Property Details Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="section-title">Property Details</h3>
                    
                    <div class="property-preview">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="property-image rounded-4 overflow-hidden">
                                    {% if booking.listing.images.first %}
                                        <img src="{{ booking.listing.images.first.image_url }}" class="img-fluid" alt="{{ booking.listing.title }}">
                                    {% else %}
                                        <img src="{% static 'img/fallback-room.svg' %}" class="img-fluid" alt="{{ booking.listing.title }}">
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h4 class="property-title">{{ booking.listing.title }}</h4>
                                <p class="property-location"><i class="bi bi-geo-alt"></i> {{ booking.listing.city }}, {{ booking.listing.state }}</p>
                                
                                <div class="property-features">
                                    <span class="feature-item"><i class="bi bi-people"></i> {{ booking.listing.max_guests }} guests</span>
                                    <span class="feature-item"><i class="bi bi-door-closed"></i> {{ booking.listing.bedrooms }} bedrooms</span>
                                    <span class="feature-item"><i class="bi bi-droplet"></i> {{ booking.listing.bathrooms }} bathrooms</span>
                                </div>
                                
                                <a href="{% url 'listing_detail' booking.listing.id %}" class="btn btn-outline-primary mt-3">
                                    <i class="bi bi-house"></i> View Property
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Details Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="section-title">Payment Details</h3>
                    
                    <div class="payment-summary">
                        <div class="price-detail d-flex justify-content-between mb-2">
                            <span>Nightly rate</span>
                            <span>₹{{ booking.listing.price }}</span>
                        </div>
                        <div class="price-detail d-flex justify-content-between mb-2">
                            <span>Cleaning fee</span>
                            <span>₹50</span>
                        </div>
                        <div class="price-detail d-flex justify-content-between mb-2">
                            <span>Service fee</span>
                            <span>₹30</span>
                        </div>
                        <hr>
                        <div class="price-total d-flex justify-content-between">
                            <strong>Total (INR)</strong>
                            <strong>₹{{ booking.total_price }}</strong>
                        </div>
                    </div>
                    
                    <div class="payment-method mt-4">
                        <h5>Payment Method</h5>
                        <div class="d-flex align-items-center">
                            <i class="bi bi-credit-card fs-4 me-2"></i>
                            <div>
                                <div>Visa ending in 1234</div>
                                <div class="text-muted">Charged on {{ booking.created_at|date:"F j, Y" }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Host Information Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="section-title">Host Information</h3>
                    
                    <div class="host-profile">
                        <div class="d-flex align-items-center mb-3">
                            {% if booking.listing.user.profile_picture %}
                                <img src="{{ booking.listing.user.profile_picture }}" class="rounded-circle me-3" width="60" height="60" alt="{{ booking.listing.user.name }}">
                            {% else %}
                                <div class="bg-secondary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                    <span>{{ booking.listing.user.name|first }}</span>
                                </div>
                            {% endif %}
                            <div>
                                <h5 class="mb-0">{{ booking.listing.user.name }}</h5>
                                <p class="text-muted mb-0">Host</p>
                            </div>
                        </div>
                        
                        <div class="host-stats mb-3">
                            <span><i class="bi bi-star-fill"></i> 4.9 Rating</span>
                            <span><i class="bi bi-shield-check"></i> Verified</span>
                        </div>
                        
                        <!-- <p>Contact the host with any questions about your booking.</p> -->
                        
                        <button class="btn btn-outline-primary w-100">
                            <i class="bi bi-chat-dots"></i> Message Host
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Actions Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="section-title">Booking Actions</h3>
                    
                    <!-- <div class="d-grid gap-3">
                        <button class="btn btn-primary">
                            <i class="bi bi-pencil"></i> Modify Booking
                        </button>
                        
                        <button class="btn btn-outline-danger">
                            <i class="bi bi-x-circle"></i> Cancel Booking
                        </button>
                        
                        <button class="btn btn-outline-secondary">
                            <i class="bi bi-printer"></i> Print Confirmation
                        </button>
                    </div> -->

                     <a href="{% url 'modify_booking' booking.id %}" class="btn btn-warning btn-sm mt-2">
                                                        <i class="bi bi-pencil"></i> Modify
                                                    </a>
                                                    <a href="{% url 'cancel_booking' booking.id %}" class="btn btn-danger btn-sm mt-2">
                                                        <i class="bi bi-x-circle"></i> Cancel
                                                    </a>


                </div>
            </div>
            
            <!-- Need Help Card -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3 class="section-title">Need Help?</h3>
                    
                    <div class="help-options">
                        <a href="#" class="help-item d-flex align-items-center mb-3">
                            <i class="bi bi-question-circle fs-4 me-3"></i>
                            <div>
                                <h6 class="mb-0">Booking FAQ</h6>
                                <p class="text-muted mb-0">Common questions about bookings</p>
                            </div>
                        </a>
                        
                        <a href="#" class="help-item d-flex align-items-center mb-3">
                            <i class="bi bi-headset fs-4 me-3"></i>
                            <div>
                                <h6 class="mb-0">Contact Support</h6>
                                <p class="text-muted mb-0">Available 24/7 for assistance</p>
                            </div>
                        </a>
                        
                        <a href="#" class="help-item d-flex align-items-center">
                            <i class="bi bi-shield-exclamation fs-4 me-3"></i>
                            <div>
                                <h6 class="mb-0">Safety Center</h6>
                                <p class="text-muted mb-0">Resources for safe travel</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}